{"componentChunkName":"component---src-templates-post-template-tsx","path":"/reactkakaologin/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>카카오 로그인</h2>\n<p>ToyProject를 진행하는 중에 카카로 로그인 기능을 넣어보고 싶어서 시작했습니다.</p>\n<p>REST API키를 사용하여 구현했습니다.</p>\n<p>일반로그인에서 가능한 권한들을 카카로로그인도 가능하게 만들었습니다.</p>\n<p>우선 시작하기전 index.html 스크립트 부분에 아래 코드를 넣어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://developers.kakao.com/sdk/js/kakao.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>카카오 API를 사용하기 위한 정보들은 Redux를 사용해서 관리하였습니다.</p>\n<p>아래는 Redux 관련 일부 소스 사진입니다.</p>\n<h2><img src=\"/0b0955363cb8e82317ec0bdfe7bbd484/redux.png\" alt=\"file:///C:/Reactblog/LEEBLOG/static/react/redux.PNG\"></h2>\n<p>카카오 로그인 기능</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//KakaoLogin.js</span>\r\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useHistory <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router'</span>\r\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useDispatch<span class=\"token punctuation\">,</span> useSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span>\r\n<span class=\"token keyword\">import</span> Swal <span class=\"token keyword\">from</span> <span class=\"token string\">'sweetalert2'</span>\r\n<span class=\"token keyword\">import</span> qs <span class=\"token keyword\">from</span> <span class=\"token string\">'qs'</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Kakao <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">KakaoLogin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> history <span class=\"token operator\">=</span> <span class=\"token function\">useHistory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> dispatch <span class=\"token operator\">=</span> <span class=\"token function\">useDispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> KaKaoStore <span class=\"token operator\">=</span> <span class=\"token function\">useSelector</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">)</span>\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>searchParams<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//인가코드 가져오기</span>\r\n    <span class=\"token comment\">//인가코드 값이 있을경우만 디비정보저장</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>code <span class=\"token operator\">!==</span> <span class=\"token string\">''</span> <span class=\"token operator\">&amp;&amp;</span> code <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">callKaKaoLoginApi</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callKaKaoLoginApi</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">code</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    Kakao<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>KaKaoStore<span class=\"token punctuation\">.</span><span class=\"token constant\">API_KEY</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//발급받은 키 중 REST API키를 사용해준다.</span>\r\n    <span class=\"token keyword\">const</span> tokendata <span class=\"token operator\">=</span> qs<span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">grant_type</span><span class=\"token operator\">:</span> <span class=\"token string\">'authorization_code'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">client_id</span><span class=\"token operator\">:</span> KaKaoStore<span class=\"token punctuation\">.</span><span class=\"token constant\">API_KEY</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">redirect_uri</span><span class=\"token operator\">:</span> KaKaoStore<span class=\"token punctuation\">.</span><span class=\"token constant\">REDIRECT_URI</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">code</span><span class=\"token operator\">:</span> code<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>\r\n        <span class=\"token string\">'https://kauth.kakao.com/oauth/token'</span><span class=\"token punctuation\">,</span>\r\n        tokendata<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">)</span>\r\n      Kakao<span class=\"token punctuation\">.</span>Auth<span class=\"token punctuation\">.</span><span class=\"token function\">setAccessToken</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>access_token<span class=\"token punctuation\">)</span> <span class=\"token comment\">//Access Token 저장</span>\r\n      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Kakao<span class=\"token punctuation\">.</span><span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'/v2/user/me'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token comment\">//로그인 후 가지고있는 Access Token은 만료기간이 짧음</span>\r\n        <span class=\"token comment\">//카카오 연동 후 각각 고유 ID값이 생겼음 그걸 DB에저장해서 로그인 처리</span>\r\n        <span class=\"token comment\">//디비회원번호값과 세션에 카카오회원번호값을 비교해서 같으면 로그인성공으로 이동</span>\r\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/LoginForm?type=kakaosignin'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token literal-property property\">is_kakaousernum</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token comment\">//디비에 값이 없으면 정보저장</span>\r\n          <span class=\"token function\">KakaoProfile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'kakaoinfosave'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//카카오 현재 유저정보 Redux 저장</span>\r\n            <span class=\"token literal-property property\">kakaoinfosave</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">kakaonickname</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token constant\">KAKAO_NICKNAME</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">kakaousernum</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token constant\">KAKAO_USER_NUM</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token literal-property property\">kakaouserrights</span><span class=\"token operator\">:</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USERRIGHTS</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>id <span class=\"token operator\">===</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token constant\">KAKAO_USER_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            history<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/List/free'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//로그인 성공</span>\r\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">sweetalert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'로그인 실패.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'닫기'</span><span class=\"token punctuation\">)</span>\r\n          <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token comment\">//카카오 회원정보 가져오기 및 로그인 정보 DB에 저장함수</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">KakaoProfile</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Kakao<span class=\"token punctuation\">.</span><span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'/v2/user/me'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n      axios\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/LoginForm?type=kakaosignup'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token comment\">//카카오 로그인 정보 DB 삽입</span>\r\n          <span class=\"token literal-property property\">is_kakaousernum</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\r\n          <span class=\"token literal-property property\">is_Nickname</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>nickname<span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data\r\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>body <span class=\"token operator\">===</span> <span class=\"token string\">'succ'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n              <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'kakaoinfosave'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//카카오 현재 유저정보 Redux 저장</span>\r\n              <span class=\"token literal-property property\">kakaoinfosave</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n                <span class=\"token literal-property property\">kakaonickname</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>properties<span class=\"token punctuation\">.</span>nickname<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">kakaousernum</span><span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\r\n                <span class=\"token literal-property property\">kakaouserrights</span><span class=\"token operator\">:</span> <span class=\"token string\">'guest'</span><span class=\"token punctuation\">,</span>\r\n              <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n            history<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/List/free'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//로그인 성공</span>\r\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">sweetalert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'작업중 오류가 발생하였습니다.'</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'닫기'</span><span class=\"token punctuation\">)</span>\r\n          <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\r\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sweetalert</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> contents<span class=\"token punctuation\">,</span> icon<span class=\"token punctuation\">,</span> confirmButtonText</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    Swal<span class=\"token punctuation\">.</span><span class=\"token function\">fire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> title<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> contents<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> icon<span class=\"token punctuation\">,</span>\r\n      <span class=\"token literal-property property\">confirmButtonText</span><span class=\"token operator\">:</span> confirmButtonText<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>a style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">float</span><span class=\"token operator\">:</span> <span class=\"token string\">'right'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> href<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>KaKaoStore<span class=\"token punctuation\">.</span><span class=\"token constant\">KAKAO_AUTH_URL_LOGIN</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>img\r\n          src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../img/layout/kakao_login_medium_narrow.png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">}</span>\r\n          alt<span class=\"token operator\">=</span><span class=\"token string\">\"\"</span>\r\n        <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span>KakaoLogin<span class=\"token punctuation\">)</span></code></pre></div>\n<h2><img src=\"/5d26a43fc89acbb0f97076312d4264a3/Login.png\" alt=\"file:///C:/Reactblog/LEEBLOG/static/react/Login.PNG\"></h2>\n<h2><img src=\"/ce3951d04779f2026e9ff69d63a90bfb/KakaoLogin.png\" alt=\"file:///C:/Reactblog/LEEBLOG/static/react/KakaoLogin.PNG\"></h2>\n<p>카카오 로그아웃 기능 / 연동해제(회원탈퇴) 기능</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//Header admin.js</span>\r\n\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useDispatch<span class=\"token punctuation\">,</span> useSelector <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-redux'</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> persistor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../index'</span>\r\n\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Kakao <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Header</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">//카카오 연동 연결해제</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Kakaodisconnect</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">await</span> persistor<span class=\"token punctuation\">.</span><span class=\"token function\">purge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//저장소에 넣어둔 redux정보들 초기화</span>\r\n    <span class=\"token keyword\">await</span> Kakao<span class=\"token punctuation\">.</span><span class=\"token constant\">API</span><span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'/v1/user/unlink'</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token function-variable function\">fail</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>\r\n          <span class=\"token string\">'카카오 회원탈퇴 처리가 실패하였습니다. \\n관리자에게 문의하시기 바랍니다.'</span><span class=\"token punctuation\">,</span>\r\n        <span class=\"token punctuation\">)</span>\r\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token comment\">//회원정보 디비도 삭제 해야함</span>\r\n    axios\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/LoginForm?type=kakaodisconnect'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token literal-property property\">is_kakaousernum</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>usernum<span class=\"token punctuation\">,</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>body <span class=\"token operator\">===</span> <span class=\"token string\">'succ'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          <span class=\"token function\">sweetalert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'카카오 회원탈퇴를 완료하였습니다.'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'닫기'</span><span class=\"token punctuation\">)</span>\r\n          window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">'/login'</span>\r\n        <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">sweetalert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'작업중 오류가 발생하였습니다.'</span><span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">,</span> <span class=\"token string\">'err'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'닫기'</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token comment\">//카카오 로그아웃</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">KakaoInfoLogout</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">await</span> persistor<span class=\"token punctuation\">.</span><span class=\"token function\">purge</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//저장소에 넣어둔 redux정보들 초기화</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>ul className<span class=\"token operator\">=</span><span class=\"token string\">\"hd_left af\"</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>li\r\n        className<span class=\"token operator\">=</span><span class=\"token string\">\"my1\"</span>\r\n        onMouseEnter<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setHover</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n        onMouseLeave<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setHover</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>b<span class=\"token operator\">></span>내정보<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>b<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span>hover <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token string\">\"box0 box1\"</span><span class=\"token operator\">></span>\r\n            <span class=\"token punctuation\">{</span>cookie_userid <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\r\n              <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">\"logout\"</span><span class=\"token operator\">></span>\r\n                  <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/#\"</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>logout<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n                    로그아웃\r\n                  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">\"Usermodify\"</span><span class=\"token operator\">></span>\r\n                  <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'/Usermodify'</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>정보 수정<span class=\"token operator\">/</span>탈퇴<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\r\n            <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\r\n              <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">\"Kakaologout\"</span><span class=\"token operator\">></span>\r\n                  <span class=\"token operator\">&lt;</span>a\r\n                    href<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>KaKaoStore<span class=\"token punctuation\">.</span><span class=\"token constant\">KAKAO_AUTH_URL_LOGOUT</span><span class=\"token punctuation\">}</span>\r\n                    onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>KakaoInfoLogout<span class=\"token punctuation\">}</span>\r\n                  <span class=\"token operator\">></span>\r\n                    카카오 로그아웃\r\n                  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span>li className<span class=\"token operator\">=</span><span class=\"token string\">\"Kakaodisconnect\"</span><span class=\"token operator\">></span>\r\n                  <span class=\"token operator\">&lt;</span>a onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>Kakaodisconnect<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>카카오 연동해제<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">></span>\r\n                <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\r\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2><img src=\"/bceb796e263965c52d0fe55d94480cca/KakaoOption.png\" alt=\"file:///C:/Reactblog/LEEBLOG/static/react/KakaoOption.PNG\"></h2>\n<p>로그아웃은 카카오계정과 함께 로그아웃 기능을 사용했습니다.</p>\n<p>카카오 계정과 함께 로그아웃은 Logout Redirect URI 등록 후 REST API로 요청할 수 있습니다.</p>\n<h2><img src=\"/1e3187257d8f328248b308402a6bab44/KakaoLogout.png\" alt=\"file:///C:/Reactblog/LEEBLOG/static/react/KakaoLogout.PNG\"></h2>\n<p>사용자가 서비스만 로그아웃을 선택했다면 즉시 앱 정보에</p>\n<p>등록된 Logout Redirect URI로 리다이렉트됩니다.</p>\n<p>사용자가 카카오 계정과 함께 로그아웃을 선택했다면 카카오 계정 세션이 존재할 경우,</p>\n<p>카카오 계정 세션을 만료시킨 후 앱 정보에 등록된 Logout Redirect URI로 리다이렉트됩니다.</p>\n<p>카카오 계정 세션이 존재하지 않을 경우,</p>\n<p>즉시 앱 정보에 등록된 Logout Redirect URI로 리다이렉트됩니다.</p>\n<p>이 서비스만 로그아웃 시 다시 로그인하면 id, PW 입력 없이 바로 로그인 가능하며</p>\n<p>카카오 계정과 함께 로그아웃은 처음부터 다시 id, PW 입력 후 로그인 가능합니다.</p>\n<p>연결 끊기는 앱과 사용자 카카오 계정의 연결을 끊는 기능입니다.</p>\n<p>연결 끊기 요청에 성공하면 해당 사용자 회원 번호를 응답으로 받을 수 있습니다.</p>\n<p>저는 props로 받은 값이 있어서 그냥 props.usernum값을 이용하여</p>\n<p>카카오 회원 정보를 저장한 DB를 삭제했습니다.</p>\n<p>token들은 자동으로 만료가 됩니다.</p>","frontmatter":{"title":"카카오로그인 기능 구현","summary":"ToyProject에서 카카오 로그인을 해보자","date":"2022.03.14.","categories":["React","ToyProject"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz2NQwgWUlZWUlZVVVEAMJWWsShhw6VVUkFeQk1WUk1WQk1VSUCBas7KyooKChrGZgU+IhrGZoW+ouoGxIki/MlGaFWSkDXyCTcIT3LrmmkYk6bn5yEtLgt2PXzPIWnlNcyvLtGLnxkk2+TVOjZMsUgo0TMxBlqPqx6ZZXs7QL8w0KsWpcZJjba9jbZ9pVIqBd7CinBwhzTAjzBOybfJqHKq6bQvqzKJTlRQViA0wBTlZHQdX45AYq8xS45A4LWt7BVkZIvwMjShFFXUNTVMLBWkpTTNLZTV1JUVFUuJZUVFBTlZZWUVRVharTnyaQbGqrAJNajgAAIe0an5q22AbAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/cba0b89d2bf2d96a1ed26edb5849f804/07887/reactthumbnail.png","srcSet":"/static/cba0b89d2bf2d96a1ed26edb5849f804/387ef/reactthumbnail.png 300w,\n/static/cba0b89d2bf2d96a1ed26edb5849f804/22925/reactthumbnail.png 600w,\n/static/cba0b89d2bf2d96a1ed26edb5849f804/07887/reactthumbnail.png 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/cba0b89d2bf2d96a1ed26edb5849f804/2fedb/reactthumbnail.webp 300w,\n/static/cba0b89d2bf2d96a1ed26edb5849f804/4fcbd/reactthumbnail.webp 600w,\n/static/cba0b89d2bf2d96a1ed26edb5849f804/0d4d1/reactthumbnail.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":630}},"publicURL":"/static/cba0b89d2bf2d96a1ed26edb5849f804/reactthumbnail.png"}}}}]}},"pageContext":{"slug":"/reactkakaologin/"}},"staticQueryHashes":[]}